<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FeiScale - 身体数据看板</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        :root { --primary: #6366f1; --accent: #10b981; --loss: #f43f5e; }
        body { 
            background: linear-gradient(135deg, #e0e7ff 0%, #f1f5f9 100%); 
            margin: 0; padding: 20px; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center; font-family: -apple-system, system-ui, sans-serif;
        }
        #capture-area {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 24px; padding: 25px;
            width: 100%; max-width: 500px; box-sizing: border-box;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.05);
        }
        header { text-align: center; margin-bottom: 25px; }
        h1 { margin: 0; font-size: 1.8rem; color: #1e293b; letter-spacing: -1px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 25px; }
        .stat-card { background: white; padding: 12px; border-radius: 16px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .stat-label { font-size: 0.7rem; color: #64748b; margin-bottom: 4px; text-transform: uppercase; }
        .stat-value { font-weight: 800; font-size: 1.2rem; color: var(--primary); }
        
        .input-area { margin-top: 25px; display: flex; gap: 10px; flex-wrap: wrap; }
        input { 
            flex: 1; min-width: 130px; padding: 12px; border: 1px solid #e2e8f0; 
            border-radius: 12px; font-size: 16px; outline: none; transition: border 0.2s;
        }
        input:focus { border-color: var(--primary); }
        .btn { 
            padding: 12px 20px; border-radius: 12px; font-weight: 600; 
            cursor: pointer; border: none; transition: transform 0.1s;
        }
        .btn-primary { background: var(--primary); color: white; flex-grow: 1; }
        .btn-outline { background: white; color: var(--primary); border: 1px solid var(--primary); margin-top: 10px; width: 100%; }
        .btn:active { transform: scale(0.98); }
    </style>
</head>
<body>

<div id="capture-area">
    <header>
        <h1>FeiScale</h1>
        <p style="font-size: 12px; color: #64748b; margin-top: 5px;">个人体重 & BMI 趋势图</p>
    </header>

    <div class="stats-grid">
        <div class="stat-card"><div class="stat-label">当前体重</div><div id="curW" class="stat-value">--</div></div>
        <div class="stat-card"><div class="stat-label">当前 BMI</div><div id="curBMI" class="stat-value" style="color:var(--accent)">--</div></div>
        <div class="stat-card"><div class="stat-label">累计减重</div><div id="totalLoss" class="stat-value" style="color:var(--loss)">--</div></div>
    </div>

    <canvas id="mainChart"></canvas>

    <div class="input-area">
        <input type="date" id="newDate">
        <input type="number" id="newWeight" step="0.01" placeholder="体重 (kg)">
        <button class="btn btn-primary" onclick="addRecord()">更新数据</button>
    </div>
    
    <button class="btn btn-outline" onclick="saveImage()">保存成果长图</button>
</div>

<script>
    const HEIGHT = 1.81;
    const historyData = [
        { date: '2025-12-09', weight: 80.90 }, { date: '2026-01-22', weight: 77.10 },
        { date: '2026-01-24', weight: 76.60 }, { date: '2026-01-25', weight: 76.30 },
        { date: '2026-01-26', weight: 76.30 }, { date: '2026-01-27', weight: 75.70 },
        { date: '2026-01-28', weight: 75.70 }, { date: '2026-01-29', weight: 75.10 },
        { date: '2026-01-30', weight: 75.10 }, { date: '2026-01-31', weight: 74.70 },
        { date: '2026-02-01', weight: 74.40 }, { date: '2026-02-02', weight: 74.30 },
        { date: '2026-02-03', weight: 73.50 }, { date: '2026-02-04', weight: 73.80 },
        { date: '2026-02-05', weight: 73.80 }, { date: '2026-02-08', weight: 73.00 },
        { date: '2026-02-09', weight: 73.20 }, { date: '2026-02-10', weight: 72.30 },
        { date: '2026-02-11', weight: 72.80 }
    ];

    let myRecords = JSON.parse(localStorage.getItem('fei_weight_logs')) || historyData;
    let chart;

    function calcBMI(weight) { return (weight / (HEIGHT * HEIGHT)).toFixed(2); }

    function init() {
        const latest = myRecords[myRecords.length - 1];
        const initial = myRecords[0];
        document.getElementById('curW').innerText = latest.weight.toFixed(1) + 'kg';
        document.getElementById('curBMI').innerText = calcBMI(latest.weight);
        document.getElementById('totalLoss').innerText = (initial.weight - latest.weight).toFixed(1) + 'kg';
        document.getElementById('newDate').valueAsDate = new Date();
        renderChart();
    }

    function renderChart() {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: myRecords.map(r => r.date.slice(5)),
                datasets: [
                    {
                        label: '体重',
                        data: myRecords.map(r => r.weight),
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        borderWidth: 4,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#6366f1',
                        pointRadius: 4,
                        yAxisID: 'y',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    y: { type: 'linear', display: true, position: 'left', grid: { color: '#f1f5f9' } },
                    x: { grid: { display: false } }
                }
            }
        });
    }

    function addRecord() {
        const date = document.getElementById('newDate').value;
        const weight = parseFloat(document.getElementById('newWeight').value);
        if(!date || isNaN(weight)) return alert('请输入有效数值');
        const idx = myRecords.findIndex(r => r.date === date);
        if (idx !== -1) myRecords[idx].weight = weight;
        else myRecords.push({ date, weight });
        myRecords.sort((a,b) => new Date(a.date) - new Date(b.date));
        localStorage.setItem('fei_weight_logs', JSON.stringify(myRecords));
        init();
    }

    function saveImage() {
        const area = document.getElementById('capture-area');
        html2canvas(area, { 
            scale: 2, 
            backgroundColor: '#e0e7ff',
            borderRadius: 24 
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `FeiScale-Progress-${new Date().toISOString().slice(0,10)}.png`;
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    init();
</script>
</body>
</html>
